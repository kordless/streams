{
  "id" : "twitter_api_gateway",
  "stages" : [ {
    "type" : "javascript-query",
    "id" : "ksa",
    "script" : "function(request, response, _context, collection, solrServer, solrClientFactory) {\n\n  var method = request.getFirstParam('method');\n  \n  var headers = {\"X-Fusion\": \"Word\" };\n  var data = { };\n   \n  var ConfigurationBuilder = Java.type('twitter4j.conf.ConfigurationBuilder');\n  var TwitterFactory = Java.type('twitter4j.TwitterFactory');\n    \n  var cb = new ConfigurationBuilder();\n\n  // TODO: have this info fed in externally (or through build/deploy)\n  cb.setDebugEnabled(true)\n    .setOAuthConsumerKey(\"\")\n    .setOAuthConsumerSecret(\"\")\n    .setOAuthAccessToken(\"\")\n    .setOAuthAccessTokenSecret(\"\");\n  \n  var tf = new TwitterFactory(cb.build());\n  var twitter = tf.getInstance();  \n    \n  switch (method) {\n    case 'lookupUsersByScreenName':\n      var sns = request.getParam('screen_name');\n      var screen_names = new Array();\n      for (var i=0; i < sns.size(); i++) {\n        screen_names.push(sns.get(i));\n      }\n      data['screen_names'] = sns;\n      data['response'] = twitter['lookupUsers(String[])'](Java.to(screen_names,'java.lang.String[]'));\n      break;\n      \n    case 'lookupUsersByID':\n      var ids = request.getParam('id');\n      var long_ids = new Array();\n      for (var i=0; i < ids.size(); i++) {\n        long_ids.push(java.lang.Long.valueOf(ids.get(i))); \n      }\n      \n      data['ids'] = ids;\n      data['response'] = twitter['lookupUsers(long[])'](long_ids);\n      break;\n\n    default:\n      data['error'] = 'Method ' + method + ' not supported';\n      break;\n  }\n  \n//      data['ids'] = ids.toArray();\n//      data['ids_raw'] = ids;\n//      var me = '1138371924';\n//      var me_long = java.lang.Long.valueOf(me);\n      //var long_array = new long[1];\n      //long_array[0] = me_long;\n      // API[\"test(Integer[])\"]\n      // Thanks to the following page for showing how to call the long[] version of lookupUsers:\n      // https://stackoverflow.com/questions/25603191/nashorn-bug-when-calling-overloaded-method-with-varargs-parameter\n  \n  \n//  data[\"size\"] = users.length;\n  \n//  if (users.length > 0) {\n//    var user = users[0];\n//    data[user.screenName] = user; //user.id;\n//  }\n  \n  var jr = new com.lucidworks.apollo.solr.response.JSONResponse(data);\n  var newResponse = new com.lucidworks.apollo.pipeline.query.Response(new javax.ws.rs.core.MultivaluedHashMap(headers), jr);\n  var queryRequestAndResponse = com.lucidworks.apollo.pipeline.query.QueryRequestAndResponse.create(request,newResponse,1);\n  return queryRequestAndResponse;\n}\n",
    "type" : "javascript-query",
    "skip" : false,
    "licensed" : true,
    "secretSourceStageId" : "ksa"
  } ],
  "properties" : {
    "secretSourcePipelineId" : "twitter_api_gateway"
  }
}
